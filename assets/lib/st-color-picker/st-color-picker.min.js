var $=jQuery;$(document).ready(function(){function o(o){var e=[],r="",n="",c=.5;0<=o.left&&o.left<=17?(n="rgb(255, 0, 255)",r="rgb(255, 0, 0)",e=[0,17]):17<=o.left&&o.left<=34?(n="rgb(0, 0, 255)",r="rgb(255, 0, 255)",e=[17,34]):34<=o.left&&o.left<=50?(n="rgb(0, 255, 255)",r="rgb(0, 0, 255)",e=[34,50]):50<=o.left&&o.left<=67?(n="rgb(0, 255, 0)",r="rgb(0, 255, 255)",e=[50,67]):67<=o.left&&o.left<=84?(n="rgb(255, 255, 0)",r="rgb(0, 255, 0)",e=[67,84]):84<=o.left&&o.left<=100&&(n="rgb(255, 0, 0)",r="rgb(255, 255, 0)",e=[84,100]),c=(o.left-e[0])/(e[1]-e[0]);var l=i(t(n),t(r),c);return l}function e(o){var e={left:0},r=[],t=[],n=[],c=0;return 255==o[0]&&0==o[1]&&0<=o[2]<=255?(r=[255,0,0],t=[255,0,255],n=[0,17],c=2):0<=o[0]<=255&&0==o[1]&&255==o[2]?(r=[255,0,255],t=[0,0,255],n=[17,34],c=0):0==o[0]&&0<=o[1]<=255&&255==o[2]?(r=[0,0,255],t=[0,255,255],n=[34,50],c=1):0==o[0]&&255==o[1]&&0<=o[2]<=255?(r=[0,255,255],t=[0,255,0],n=[50,67],c=2):0<=o[0]<=255&&255==o[1]&&0==o[2]?(r=[0,255,0],t=[255,255,0],n=[67,84],c=0):255==o[0]&&0<=o[1]<=255&&0==o[2]&&(r=[255,255,0],t=[255,0,0],n=[84,100],c=1),t[c]<r[c]?e.left=n[0]+(100-o[c]/255*100)*(n[1]-n[0])/100:e.left=n[0]+o[c]/255*100*(n[1]-n[0])/100,e}function r(o){var e=o[3],r={},t={white:[255,255,255],black:[0,0,0]};o.splice(3,1);var n=Math.min.apply(null,o),c=Math.max.apply(null,o);if(r.opacity=e,r.blackPercent=c/255,0!=r.blackPercent)for(var l=0;2>=l;l++)o[l]=(o[l]-t.black[l]*(1-r.blackPercent))/r.blackPercent;else o=[255,0,0];if(n=Math.min.apply(null,o),c=Math.max.apply(null,o),r.whitePercent=1-n/255,0!=r.whitePercent)for(var l=0;2>=l;l++)o[l]=Math.round((o[l]-t.white[l]*(1-r.whitePercent))/r.whitePercent);else o=[255,0,0];return r.uniqueColor="rgb("+o[0]+","+o[1]+","+o[2]+")",isNaN(r.whitePercent)&&(r.whitePercent=0),r.blackPercent=100-100*r.blackPercent,r.whitePercent=100-100*r.whitePercent,r}function t(o){if(o){if("transparent"===o.toLowerCase())return[0,0,0,0];if("#"===o[0])return o.length<7&&(o="#"+o[1]+o[1]+o[2]+o[2]+o[3]+o[3]+(o.length>4?o[4]+o[4]:"")),[parseInt(o.substr(1,2),16),parseInt(o.substr(3,2),16),parseInt(o.substr(5,2),16),o.length>7?parseInt(o.substr(7,2),16)/255:1];if(-1===o.indexOf("rgb")){var e=document.body.appendChild(document.createElement("fictum")),r="rgb(1, 2, 3)";if(e.style.color=r,e.style.color!==r)return;if(e.style.color=o,e.style.color===r||""===e.style.color)return;o=getComputedStyle(e).color,document.body.removeChild(e)}return 0===o.indexOf("rgb")?(-1===o.indexOf("rgba")&&(o+=",1"),o.match(/[\.\d]+/g).map(function(o){return+o})):void 0}}function n(o,e){var r=t(o);return o=1==e?"#"+c(r[0])+c(r[1])+c(r[2]):"rgba("+r[0]+","+r[1]+","+r[2]+","+e+")"}function c(o){var e=o.toString(16);return 1==e.length?"0"+e:e}function l(o,e,r){var t=o*r,n=e*(1-r);return parseInt(t+n)}function i(o,e,r){var t=l(o[0],e[0],r),n=l(o[1],e[1],r),c=l(o[2],e[2],r);return"rgb("+t+","+n+","+c+")"}function a(){$(".st-color-picker .container .color-selecter, .st-color-picker .container .opacity-line .opacity-selecter").draggable({drag:function(o,e){var r=$(this);1==r.parents(".st-color-picker .container .color-square").length?r.stPickColorFromColorArea(e):1==r.parents(".st-color-picker .container .colors-line").length?r.stPickColorFromColorsLine(e):r.stAddOpacityToColor()},containment:"parent"})}$.fn.outerHTML=function(){return $("<div />").append(this.eq(0).clone()).html()},$.fn.stColorPicker=function(){$(this).each(function(){var o=$(this),n="st-color-picker "+(o.is("[data-classes]")?o.attr("data-classes"):"");o.removeClass("saturtheme-color-picker").addClass("color-input"),o.css({width:"100%",height:"40px",padding:"0 10px",border:"1px solid #ccc","box-shadow":"none",color:"#555",font:"16px sans-serif","text-align":"center"});var c=o.outerHTML(),l=o.attr("data-select-text"),i={uniqueColor:"rgb(255, 0, 0)",whitePercent:0,blackPercent:0,opacity:1},s=i.uniqueColor;if(t(o.val())){i=r(t(o.val()));var p=t(o.val());s="rgb("+p[0]+","+p[1]+","+p[2]+")"}var f=e(t(i.uniqueColor));0==f.left&&(f.left=100);var u='<div class="'+n+'"><span class="preview-color"><span class="color"><span style="background-color:'+o.val()+';"></span></span><span class="select-text">';u+=l?l:"Select Color",u+='</span></span><div class="container">'+c+'<div class="pick-color"><div class="color-square"><span class="unique-color" style="background-color:'+i.uniqueColor+';"></span><span class="black"></span><span class="white"></span><span class="color-selecter" style="background-color:'+s+";top:"+i.blackPercent+"%;left:"+(100-i.whitePercent)+'%;"></span></div><div class="colors-line"><span class="color-selecter" style="background-color:'+i.uniqueColor+";left:"+f.left+'%;"></span></div><div class="opacity-line"><span class="color" style="background:linear-gradient(to right, transparent 0%, '+s+' 100%);"></span><span class="opacity-selecter" style="left:'+100*i.opacity+'%;" data-opacity-value="'+Math.floor(100*i.opacity)+'"></span></div></div></div></div>',o.replaceWith(u),a()})},$(".saturtheme-color-picker").stColorPicker(),$(document).on("DOMNodeInserted ajaxComplete",function(){$(".saturtheme-color-picker").stColorPicker()}),$("body").on("keyup",".st-color-picker .container .color-input",function(){var o=$(this).val();$(this).parents(".st-color-picker").find(".preview-color .color span").css({"background-color":o})}),$.fn.stPickColorFromColorArea=function(o,e){var r=$(this),c=r.parents(".st-color-picker"),l=c.find(".container .pick-color .opacity-line"),a={width:c.find(".color-square").innerWidth(),height:c.find(".color-square").innerHeight()},s={top:o.position.top/a.height*100,left:o.position.left/a.width*100},p={white:t("white"),black:t("black"),uniqueColor:t(c.find(".container .unique-color").css("background-color"))},f=s.left/100,u=((100-s.left)/100,s.top/100),d=i(p.uniqueColor,p.white,f);d=i(p.black,t(d),u);var h=t(d);h[0]>220&&h[1]>220&&h[2]>220?r.css("border-color","#555"):r.css("border-color",""),$(this).parents(".opacity-line").hasClass("opacity-line")===!1&&(r.css("background-color",d),c.find(".container .opacity-line .color").css("background","linear-gradient(to right, transparent 0%, "+d+" 100%)"));var e=l.find(".opacity-selecter").stGetOpacityValue();d=n(d,e),c.find(".preview-color .color>span").css("background-color",d),c.find("input").val(d).trigger("keyup").trigger("change")},$.fn.stPickColorFromColorsLine=function(e){var r=$(this),n=r.parents(".st-color-picker"),c=({width:n.find(".color-square").innerWidth(),height:n.find(".color-square").innerHeight()},{width:n.find(".colors-line").innerWidth(),height:n.find(".colors-line").innerHeight()}),l={top:e.position.top/c.height*100,left:e.position.left/c.width*100},i=({white:t("white"),black:t("black"),uniqueColor:t(n.find(".container .unique-color").css("background-color"))},o(l));r.css("background-color",i),n.find(".container .color-square .unique-color").css("background-color",i),e={position:{left:n.find(".container .color-square .color-selecter").offset().left-n.find(".container .color-square").offset().left+10,top:n.find(".container .color-square .color-selecter").offset().top-n.find(".container .color-square").offset().top+10}},n.find(".container .color-square .color-selecter").stPickColorFromColorArea(e)},$.fn.stGetOpacityValue=function(o){var e=($(this).parents(".st-color-picker"),$(this).parents(".container .pick-color .opacity-line")),r=e.innerWidth(),t=e.find(".opacity-selecter").offset().left-e.offset().left+15,n=Math.floor(t/r*100);return"percent"==o?n:n/100},$.fn.stAddOpacityToColor=function(){var o=$(this).parents(".st-color-picker"),e=$(this).stGetOpacityValue(),r={position:{left:o.find(".container .color-square .color-selecter").offset().left-o.find(".container .color-square").offset().left+10,top:o.find(".container .color-square .color-selecter").offset().top-o.find(".container .color-square").offset().top+10}};o.find(".container .color-square .color-selecter").stPickColorFromColorArea(r,e),$(this).attr("data-opacity-value",$(this).stGetOpacityValue("percent"))},a(),$("body").on("click",".st-color-picker .container .color-square, .st-color-picker .container .colors-line, .st-color-picker .container .opacity-line",function(o){var e=$(this),r=(e.parents(".st-color-picker"),e.find(".color-selecter")),t=Math.round(o.pageX-e.offset().left),n=Math.round(o.pageY-e.offset().top);e.hasClass("opacity-line")&&(r=e.find(".opacity-selecter")),(e.hasClass("colors-line")||e.hasClass("opacity-line"))&&(n=""),r.css({left:t,top:n});var c={position:{left:t,top:n}};if(e.hasClass("color-square"))r.stPickColorFromColorArea(c);else if(e.hasClass("colors-line"))r.stPickColorFromColorsLine(c);else{var l=Math.floor(t/e.innerWidth()*100);r.attr("data-opacity-value",l),r.stAddOpacityToColor()}}),$("body").on("click",".st-color-picker .preview-color",function(){var o=$(this).parents(".st-color-picker");o.hasClass("open")===!1?($(".st-color-picker").removeClass("open"),o.addClass("open")):($(".st-color-picker").removeClass("open"),o.removeClass("open"))}),$("*").on("click",function(o){var e=$(".st-color-picker");o.target.className==e.attr("class")||e.has(o.target).length||e.removeClass("open")})});